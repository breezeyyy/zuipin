"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}new(function(){function t(){_classCallCheck(this,t),this.url="http: //localhost:3000/api",this.tabs=document.querySelectorAll(".login_tab li"),this.accountInput=document.querySelectorAll(".phone"),this.loginBox=document.querySelectorAll(".login_method li"),this.infoBox=document.querySelector(".infoBox").children,this.account=this.accountInput[1],this.errorInfo=document.querySelectorAll(".phoneTip"),this.psdInp=document.querySelectorAll(".psd"),this.btns=document.querySelectorAll(".login_btn"),this.btnFlags=[!1,!1],this.emailReg=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,this.telReg=/^1[3-9]\d{9}$/,this.psdReg=/^.{6,16}$/,this.addLoginEvent()}return _createClass(t,[{key:"addLoginEvent",value:function(){var n=this;this.tabs.forEach(function(t,e){addEvent(t,"click",function(){n.clearTabClass(),t.className="on",n.loginBox[e].className="on",n.infoBox[e].style.display="block",n.accountInput[e].focus()})}),this.accountInput.forEach(function(t,e){addEvent(t,"input",function(){!this.value||n.telReg.test(this.value)||n.emailReg.test(this.value)?n.hideErrInfo(e):n.showErrInfo(e,0),n.judgeLoginStatus(e)})}),addEvent(this.infoBox[0],"click",function(){n.tabs[1].click()}),addEvent(this.psdInp[0],"input",function(){this.value?n.psdReg.test(this.value)?n.psdInp[1].value!==this.value&&n.psdInp[1].value?n.showErrInfo(0,1):n.hideErrInfo(0):n.showErrInfo(0,2):n.hideErrInfo(0),n.judgeLoginStatus(0)}),addEvent(this.psdInp[1],"input",function(){this.value?n.psdReg.test(this.value)?n.psdInp[0].value!==this.value&&n.psdInp[0].value?n.showErrInfo(0,1):n.hideErrInfo(0):n.showErrInfo(0,2):n.hideErrInfo(0),n.judgeLoginStatus(0)}),addEvent(this.psdInp[2],"input",function(){!this.value||n.psdReg.test(this.value)?n.hideErrInfo(1):n.showErrInfo(1,2),n.judgeLoginStatus(1)}),addEvent(this.btns[0],"click",function(){n.btnFlags[0]&&ajax({type:"GET",url:n.url,success:function(t){n.login(t)},error:function(t){console.log(t)},search:{type:"register",username:n.accountInput[0].value,password:n.psdInp[0].value}})}),addEvent(this.btns[1],"click",function(){n.btnFlags[1]&&ajax({type:"GET",url:n.url,success:function(t){n.login(t)},error:function(t){console.log(t)},search:{type:"login",username:n.accountInput[1].value,password:n.psdInp[2].value}})})}},{key:"judgeLoginStatus",value:function(t){t?(this.telReg.test(this.accountInput[1].value)||this.emailReg.test(this.accountInput[1].value))&&this.psdReg.test(this.psdInp[2].value)?(this.btnFlags[t]=!0,this.btns[t].className="login_btn right"):(this.btnFlags[t]=!1,this.btns[t].className="login_btn"):(this.telReg.test(this.accountInput[0].value)||this.emailReg.test(this.accountInput[0].value))&&this.psdReg.test(this.psdInp[0].value)&&this.psdReg.test(this.psdInp[1].value)&&this.psdInp[0].value===this.psdInp[1].value?(this.btnFlags[t]=!0,this.btns[t].className="login_btn right"):(this.btnFlags[t]=!1,this.btns[t].className="login_btn")}},{key:"login",value:function(t){var e;0===t.code?(setCookie("isLogin","ok",{expires:3}),setCookie("username",t.data.username,{expires:3}),setCookie("goods",JSON.stringify(t.data.cartData),{expires:3}),e=getCookie("href"),setCookie("href"),location.href=e||"./index.html"):1===t.code?(alert("密码不符，请重新输入"),this.psdInp[2].value="",this.psdInp[2].focus()):2===t.code?confirm("账号不存在，是否前往注册该账号？")?(this.tabs[0].click(),this.accountInput[0].value=this.accountInput[1].value,this.psdInp[0].value="",this.psdInp[0].focus(),this.psdInp[1].value=""):(this.accountInput[1].value="",this.accountInput[1].focus()):3===t.code&&(alert("注册失败，账号重复"),this.accountInput[0].value="",this.accountInput[0].focus())}},{key:"showErrInfo",value:function(t,e){this.errorInfo[t].style.display="block",this.errorInfo[t].children[1].innerHTML=["您输入的账号格式有误，请核实后重新输入","您输入的两次密码不一致","您输入的密码格式有误，密码长度为6-16位"][e]}},{key:"hideErrInfo",value:function(t){this.errorInfo[t].style.display="none"}},{key:"clearTabClass",value:function(){var n=this;this.tabs.forEach(function(t,e){t.className="",n.loginBox[e].className="",n.infoBox[e].style.display="none"})}}]),t}());