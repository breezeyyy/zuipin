"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}window.onload=function(){var e=function(){function e(){_classCallCheck(this,e),this.nowIndex,this.li,this.closeFlag=!1,this.url="https://suggest.taobao.com/sug",this.myServer="http://localhost:3000/api",this.searchBox=document.querySelector(".search"),this.search=document.querySelector(".search-cont"),this.text=document.querySelector("#text"),this.options=document.querySelector(".search .options"),this.button=document.querySelector(".search-cont button"),this.loginBox=document.querySelector(".header_r").children[0],this.loginBtn=document.querySelector(".toLogin"),this.uesrname=document.querySelector(".username"),this.loginOutBtn=document.querySelector(".loginout"),this.cart=document.querySelector(".cart"),this.cartNum=document.querySelector(".cartNum"),this.isLogin(),this.classAddEvent()}return _createClass(e,[{key:"isLogin",value:function(){var e="ok"===getCookie("isLogin"),t=JSON.parse(getCookie("goods"));this.loginBox.className=e?"myaccount":"",this.loginBtn.href=e?"./personal.html":"./login.html",this.loginBtn.innerHTML=e?"我的账户":"登录",this.uesrname.innerHTML=e?getCookie("username"):"",this.cartNum.style.display=e?"block":"none",this.cartNum.innerHTML=t.length?t.reduce(function(e,t){return e+t.num},0):0}},{key:"classAddEvent",value:function(){var t=this;addEvent(this.text,"input",function(){t.text.value?(t.closeFlag=!0,t.nowValue=t.text.value,t.getDatas()):(t.closeFlag=!1,t.listHide())}),addEvent(this.loginOutBtn,"click",function(){ajax({url:t.myServer,type:"GET",success:function(e){},fail:function(e){console.log(e)},search:{type:"writeCartData",username:getCookie("username"),cartData:getCookie("goods")}}),setCookie("isLogin"),setCookie("username"),setCookie("goods","[]"),t.isLogin(),location.href="./login.html"}),addEvent(document,"click",function(e){e=getTarget(e);"INPUT"===e.nodeName&&e.parentElement.className.includes("search-cont")?(t.text.focus(),t.nowValue&&t.getDatas()):"LI"===e.nodeName&&"options"===e.parentElement.className?(t.nowValue=t.li[t.nowIndex].innerHTML,t.changeTextValue(t.li[t.nowIndex].innerHTML),t.listHide()):"UL"!==e.nodeName&&"BUTTON"!==e.nodeName&&t.lostFocus()}),addEvent(this.text,"focus",function(){t.getFocus(),t.nowValue&&t.getDatas()}),addEvent(this.button,"mouseenter",function(){t.search.className="search-cont search-active"}),addEvent(this.button,"mouseleave",function(){t.text!==document.activeElement&&(t.search.className="search-cont")})}},{key:"liAddEvent",value:function(){var n=this;this.li=this.options.children,Array.from(this.li).forEach(function(e,t){addEvent(e,"mouseenter",function(){n.clearPrevOptionStyle(),n.optionActive(t)}),addEvent(e,"mouseleave",function(){n.clearPrevOptionStyle()})})}},{key:"documentAddKeyEvent",value:function(){var t=this;document.onkeydown=function(e){e=getEvent(e),e=e.keycode||e.which;38===e?t.keyPrev():40===e?t.keyNext():13===e&&(t.nowValue=t.li[t.nowIndex].innerHTML,t.listHide())}}},{key:"documentRemovekeyEvent",value:function(){document.onkeydown=null}},{key:"getDatas",value:function(){var t=this;jsonp(this.url,function(e){t.optionInit(e.result)},{code:"utf-8",q:this.nowValue,callback:"callback",fieldName:"callback"})}},{key:"optionInit",value:function(e){if(e.length){for(var t="",n=0;n<e.length;n++)t+="<li>".concat(e[n][0],"</li>");this.options.innerHTML=t,this.listShow(),this.liAddEvent()}else this.listHide()}},{key:"getFocus",value:function(){this.search.className="search-cont search-active"}},{key:"lostFocus",value:function(){this.nowValue=this.text.value,this.search.className="search-cont",this.options.style.display="none"}},{key:"listShow",value:function(){this.closeFlag&&(this.options.style.display="block",this.documentAddKeyEvent())}},{key:"listHide",value:function(){this.nowIndex=void 0,this.options.style.display="none",this.documentRemovekeyEvent()}},{key:"optionActive",value:function(e){this.nowIndex=e,this.li[this.nowIndex].className="active"}},{key:"clearPrevOptionStyle",value:function(){isNaN(this.nowIndex)||-1===this.nowIndex||this.nowIndex===this.li.length||(this.li[this.nowIndex].className="")}},{key:"changeTextValue",value:function(e){this.text.value=e}},{key:"keyPrev",value:function(){this.clearPrevOptionStyle(),isNaN(this.nowIndex)||-1===this.nowIndex?this.optionActive(this.li.length-1):0===this.nowIndex?this.nowIndex=this.li.length:this.optionActive(this.nowIndex-1),this.nowIndex!==this.li.length?this.changeTextValue(this.li[this.nowIndex].innerHTML):this.changeTextValue(this.nowValue)}},{key:"keyNext",value:function(){this.clearPrevOptionStyle(),isNaN(this.nowIndex)||this.nowIndex===this.li.length?this.optionActive(0):this.nowIndex===this.li.length-1?this.nowIndex=-1:this.optionActive(this.nowIndex+1),-1!==this.nowIndex?this.changeTextValue(this.li[this.nowIndex].innerHTML):this.changeTextValue(this.nowValue)}}]),e}(),t=function(){function e(){_classCallCheck(this,e),this.nav=document.querySelector(".good-list"),this.navAddEvent()}return _createClass(e,[{key:"navAddEvent",value:function(){var t=this;addEvent(this.nav,"mouseenter",function(e){t.show(this),Array.from(this.lastElementChild.children).forEach(function(e){e.onmouseenter=function(){t.show(this)}}),Array.from(this.lastElementChild.children).forEach(function(e){e.onmouseleave=function(){t.hide(this)}})}),addEvent(this.nav,"mouseleave",function(e){this.className.includes("list_html")&&t.hide(this)})}},{key:"show",value:function(e){e.lastElementChild.style.display="block"}},{key:"hide",value:function(e){e.lastElementChild.style.display="none"}}]),e}(),n=function(){function e(){_classCallCheck(this,e),this.top=document.querySelector(".toTop"),this.judgeStatus(),this.topAddEvent()}return _createClass(e,[{key:"topAddEvent",value:function(){var e=this;addEvent(document,"scroll",function(){e.judgeStatus()}),addEvent(this.top,"click",function(){elementAnimation(document.documentElement,{scrollTop:0})})}},{key:"judgeStatus",value:function(){500<=document.documentElement.scrollTop?this.show():this.hide()}},{key:"show",value:function(){var e=this;this.top.style.display="block",this.setDelay(function(){e.top.style.opacity="1"},20)}},{key:"hide",value:function(){var e=this;this.top.style.opacity="0",this.setDelay(function(){e.top.style.display="none"},400)}},{key:"setDelay",value:function(e,t){clearTimeout(this.timeOutIndex),this.timeOutIndex=setTimeout(e,t)}}]),e}(),i=function(){function e(){_classCallCheck(this,e),this.imageBox=document.querySelectorAll(".item-desc"),this.getImageData(),addEvent(document.querySelector(".cart"),"click",function(){location.href="./cart.html"})}return _createClass(e,[{key:"getImageData",value:function(){var t=this;ajax({type:"GET",url:"http://localhost:3000/api",success:function(e){e.code&&t.renderer(e.data)},error:function(e){console.log(e)},search:{type:"common_data"}})}},{key:"renderer",value:function(e){var t,n=0;for(t in e){var i="<ul>";e[t].forEach(function(e){i+='<li><img src="./images/common/'.concat(e.img,'"><span>').concat(e.info,"</span></li>")}),this.imageBox[n++].innerHTML=i+"</ul>"}}}]),e}();setTimeout(function(){new i,new n,new t,new e},200)};